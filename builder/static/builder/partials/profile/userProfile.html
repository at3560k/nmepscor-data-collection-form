<div class="container" >
  <div class="row">
    <div class="col-md-12">
      <div class="page-header">
        <h2>NMEPSCoR Metadata Tool: <small>User Profile</small></h2>
      </div>
    </div>

  </div>

  <div class="panel panel-info">
    <div class="panel-heading">
      <h5> Instructions </h5>
    </div>
    <div class="panel-body">
      <ol>
        <li>Please supply your name and contact email.</li>
        <li>Please add contact information for any PI you work with</li>
        <li>Please do not reuse or add any shared email addresses, every PI
        should have one unique contact address, preferrably their official
        (university) account </li>
      </ol>
    </div>
  </div>

  <div class="panel panel-basic" ng-controller="userProfileController">
    <!--
    <pre> form = {{profile | json}}</pre>
    -->
    <div class="col-md-12">
      <form name="userProfileForm" novalidate>
        <div class="form-group" ng-class="{ 'has-error' : userProfileForm.firstname.$invalid && !userProfileForm.firstname.$pristine }">
          <label>First Name</label>
          <input class="form-control" type="text" ng-model="profile.first" type="text" placeholder="Your First Name" name='firstname' required>
          <p ng-show="userProfileForm.firstname.$invalid && !userForm.firstname.$pristine" class="help-block">
            Your name is required.
          </p>
        </div>

        <div class="form-group" ng-class="{ 'has-error' : userProfileForm.lastname.$invalid && !userProfileForm.lastname.$pristine }">
          <label>Last Name</label>
          <input class="form-control" type="text" ng-model="profile.last" type="text" placeholder="Your Last Name" name='lastname' required>
          <p ng-show="userProfileForm.lastname.$invalid && !userForm.lastname.$pristine" class="help-block">
            Your name is required.
          </p>
        </div>

        <div class="form-group" ng-class="{ 'has-error' : userProfileForm.lastname.$invalid && !userProfileForm.lastname.$pristine }">
          <label>E-Mail</label>
          <input class="form-control" type="email" ng-model="profile.email" type="text" placeholder="Your EMail" name='email' required>
          <p ng-show="userForm.email.$invalid && !userForm.email.$pristine" class="help-block">Enter a valid email.</p>
        </div>
      </form>
    </div>


    <div class="panel-body">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3>My Principle Investigators: <small>Contact Information</small></h3>
        </div>

        <div class="panel-body">
          <!-- @see http://vitalets.github.io/angular-xeditable/#editable-table -->
          <form editable-form name="piForm" onaftersave="saveTable()" oncancel="cancel()">
            <table class="table table-bordered table-hover table-condensed">
              <thead>
                <th>Name</th>
                <th>Institution</th>
                <th>Email</th>

                <th ng-show="piForm.$visible">
                  <span>Action</span>
                </th>
              </thead>
              <tbody>

                <tr ng-repeat="pi in profile.investigators">
                  <td>
                    <span editable-text="pi.name" e-form="piForm">
                      {{pi.name || 'unknown' }}
                    </span>
                  </td>

                  <td>
                    <span editable-select="pi.institution"
                      e-ng-options="IO.value as IO.text for IO in INSTITUTION_OPTIONS">
                      {{ showInstitution(pi) }}
                    </span>
                  </td>

                  <td>
                    <span editable-email="pi.email" e-form="piForm">
                      {{pi.email || 'unknown' }}
                    </span>
                  </td>

                  <td ng-show="piForm.$visible">
                    <button type="button" ng-show="piForm.$visible" ng-click="deleteRow($index)"
                      class="btn btn-danger pull-right"> Del
                    </button>
                  </td>
                </tr>
              </tbody>

            </table>
            <!-- buttons -->
            <div class="btn-edit">
              <button type="button" class="btn btn-default" ng-show="!piForm.$visible" ng-click="piForm.$show()">
                Edit
              </button>
            </div>

            <div class="btn-form" ng-show="piForm.$visible">
              <button type="button" ng-disabled="piForm.$waiting"
                ng-click="addRow()" class="btn btn-default pull-right">
                <span class="glyphicon glyphicon-plus-sign">
                  Add Row
                </span>
              </button>

              <button type="button" ng-disabled="piForm.$waiting" ng-click="piForm.$cancel()" class="btn btn-default">
                Cancel
              </button>
            </div>
          </form>

         </div>
      </div>
    </div>

    <button type="button" ng-click="piForm.$cancel(); go2('/')" class="btn btn-default">
      Cancel
    </button>

    <button type="submit" ng-click="saveTable(); go2('/')" ng-disabled="piForm.$invalid || userProfileForm.$invalid" class="btn btn-primary">
      Save
    </button>
  </div>
</div>
